<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('partials/header') %>
</head>

<body>
  <main>
    <h1>My Book Notes</h1>

    <form action="/add" method="POST">
      <input type="text" name="title" placeholder="Book Title" required>
      <input type="text" name="author" placeholder="Author" required>
      <input type="text" name="isbn" placeholder="ISBN (optional)">
      <input type="number" name="rating" min="1" max="5" placeholder="Rating (1â€“5)">
      <textarea name="notes" placeholder="Notes about the book"></textarea>
      <button type="submit">Add Book</button>
    </form>

    <h2>Books Read</h2>
    <ul class="book-list">
      <% books.forEach(book=> { %>
        <li class="book-card">
          <% if (book.cover_edition_key) { %>
            <form action="/book" method="POST" target="_blank">
              <input type="hidden" name="olid" value="<%= book.cover_edition_key %>">
              <button type="submit" style="border: none; background: none; padding: 0;">
                <img class="cover" src="https://covers.openlibrary.org/b/olid/<%= book.cover_edition_key %>-M.jpg"
                  alt="Cover for <%= book.title %>">
              </button>
            </form>
            <% } else if (book.isbn && book.isbn.trim() !=="" ) { %>
              <form action="/book" method="POST" target="_blank">
                <input type="hidden" name="isbn" value="<%= book.isbn %>">
                <button type="submit" style="border: none; background: none; padding: 0;">
                  <img class="cover" src="https://covers.openlibrary.org/b/isbn/<%= book.isbn %>-M.jpg"
                    alt="Cover for <%= book.title %>">
                </button>
              </form>
              <% } else { %>
                <div class="no-cover">No Cover</div>
                <% } %>


                  <div class="book-info">
                    <h3>
                      <% if (book.cover_edition_key || book.isbn) { %>
                        <form action="/book" method="POST" target="_blank" style="display: inline;">
                          <% if (book.cover_edition_key) { %>
                            <input type="hidden" name="olid" value="<%= book.cover_edition_key %>">
                            <% } else if (book.isbn) { %>
                              <input type="hidden" name="isbn" value="<%= book.isbn %>">
                              <% } %>
                                <button type="submit" class="book-title-button">
                                  <%= book.title %>
                                </button>
                        </form>
                        <% } else { %>
                          <h3>
                            <%= book.title %>
                          </h3>
                          <% } %>

                    </h3>
                    <p><em>by <%= book.author %></em></p>
                    <% if (book.rating) { %>
                      <p>Rating: <%= book.rating %>/5</p>
                      <% } %>
                        <% if (book.notes) { %>
                          <p>
                            <%= book.notes %>
                          </p>
                          <% } %>
                            <form action="/delete/<%= book.id %>" method="POST">
                              <button type="submit">Delete</button>
                            </form>
                  </div>
        </li>
        <% }) %>

    </ul>
  </main>

  <%- include('partials/footer') %>
</body>

</html>